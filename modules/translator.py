from deep_translator import GoogleTranslator
import streamlit as st
import logging

logger = logging.getLogger(__name__)

# Language mapping
LANGUAGES = {
    "English": "en",
    "Hindi": "hi",
    "Telugu": "te",
    "Tamil": "ta"
}

# Static UI Translations (hardcoded for speed/reliability)
UI_LABELS = {
    "en": {
        "title": "SmartMed AI",
        "subheader": "Medical Report Analyzer",
        "upload_label": "Upload your medical report (PDF / Image)",
        "success": "File uploaded successfully.",
        "file_name": "File Name",
        "file_size": "File Size",
        "extracting_img": "Extracting text from image...",
        "extracting_pdf": "Extracting text from PDF...",
        "results_title": "Analysis Results",
        "no_data": "No structured medical data found.",
        "view_raw": "View Raw Extracted Text",
        "extraction_failed": "Extraction failed",
        "delete_btn": "Delete File",
        "delete_success": "File deleted successfully.",
        "rec_title": "Personalized Recommendations",
        "rec_intro": "Based on your results, here are some lifestyle and dietary suggestions.",
        "foods": "ЁЯеЧ Foods to Eat",
        "lifestyle": "ЁЯПГ Lifestyle",
        "avoid": "ЁЯЪл Avoid",
        "disclaimer": "тЪая╕П Disclaimer: These recommendations are for informational purposes only and do not constitute medical advice. Please consult your healthcare provider.",
        "app_warning": "This app provides general health information. Please consult a doctor.",
        "feedback_title": "Was this helpful?"
    },
    "hi": {
        "title": "рд╕реНрдорд╛рд░реНрдЯрдореЗрдб рдПрдЖрдИ",
        "subheader": "рдореЗрдбрд┐рдХрд▓ рд░рд┐рдкреЛрд░реНрдЯ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ",
        "upload_label": "рдЕрдкрдиреА рдореЗрдбрд┐рдХрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ (PDF / Image)",
        "success": "рдлрд╝рд╛рдЗрд▓ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИред",
        "file_name": "рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо",
        "file_size": "рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЖрдХрд╛рд░",
        "extracting_img": "рдЫрд╡рд┐ рд╕реЗ рдЯреЗрдХреНрд╕реНрдЯ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ...",
        "extracting_pdf": "PDF рд╕реЗ рдЯреЗрдХреНрд╕реНрдЯ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ...",
        "results_title": "рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдкрд░рд┐рдгрд╛рдо",
        "no_data": "рдХреЛрдИ рд╕рдВрд░рдЪрд┐рдд рдореЗрдбрд┐рдХрд▓ рдбреЗрдЯрд╛ рдирд╣реАрдВ рдорд┐рд▓рд╛ред",
        "view_raw": "рдХрдЪреНрдЪрд╛ рдЯреЗрдХреНрд╕реНрдЯ рджреЗрдЦреЗрдВ",
        "extraction_failed": "рдирд┐рд╖реНрдХрд░реНрд╖рдг рд╡рд┐рдлрд▓",
        "delete_btn": "рдлрд╝рд╛рдЗрд▓ рд╣рдЯрд╛рдПрдВ",
        "delete_success": "рдлрд╝рд╛рдЗрд▓ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╣рдЯрд╛ рджреА рдЧрдИред",
        "rec_title": "рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ",
        "rec_intro": "рдЖрдкрдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдпрд╣рд╛рдБ рдХреБрдЫ рдЬреАрд╡рдирд╢реИрд▓реА рдФрд░ рдЖрд╣рд╛рд░ рд╕реБрдЭрд╛рд╡ рджрд┐рдП рдЧрдП рд╣реИрдВред",
        "foods": "ЁЯеЧ рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рднреЛрдЬрди",
        "lifestyle": "ЁЯПГ рдЬреАрд╡рдирд╢реИрд▓реА",
        "avoid": "ЁЯЪл рдмрдЪреЗрдВ",
        "disclaimer": "тЪая╕П рдЕрд╕реНрд╡реАрдХрд░рдг: рдпреЗ рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ рдХреЗрд╡рд▓ рд╕реВрдЪрдирд╛рддреНрдордХ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реИрдВ рдФрд░ рдЪрд┐рдХрд┐рддреНрд╕рд╛ рд╕рд▓рд╛рд╣ рдирд╣реАрдВ рд╣реИрдВред рдХреГрдкрдпрд╛ рдЕрдкрдиреЗ рдбреЙрдХреНрдЯрд░ рд╕реЗ рдкрд░рд╛рдорд░реНрд╢ рдХрд░реЗрдВред",
        "app_warning": "рдпрд╣ рдРрдк рд╕рд╛рдорд╛рдиреНрдп рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдХреГрдкрдпрд╛ рдбреЙрдХреНрдЯрд░ рд╕реЗ рд╕рд▓рд╛рд╣ рд▓реЗрдВред",
        "feedback_title": "рдХреНрдпрд╛ рдпрд╣ рд╕рд╣рд╛рдпрдХ рдерд╛?"
    },
    "te": {
        "title": "р░╕р▒Нр░ор░╛р░░р▒Нр░Яр▒Н р░ор▒Жр░бр▒Н AI",
        "subheader": "р░ор▒Жр░бр░┐р░Хр░▓р▒Н р░░р░┐р░кр▒Лр░░р▒Нр░Яр▒Н р░Ер░ир░▓р▒Ир░Ьр░░р▒Н",
        "upload_label": "р░ор▒А р░╡р▒Ир░жр▒Нр░п р░ир░┐р░╡р▒Зр░жр░┐р░Хр░ир▒Б р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░Вр░бр░┐ (PDF / Image)",
        "success": "р░лр▒Ир░▓р▒Н р░╡р░┐р░Ьр░пр░╡р░Вр░др░Вр░Чр░╛ р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░мр░бр░┐р░Вр░жр░┐.",
        "file_name": "р░лр▒Ир░▓р▒Н р░кр▒Зр░░р▒Б",
        "file_size": "р░лр▒Ир░▓р▒Н р░кр░░р░┐р░ор░╛р░гр░В",
        "extracting_img": "р░Ър░┐р░др▒Нр░░р░В р░ир▒Бр░Вр░бр░┐ р░╡р░Ър░ир░╛р░ир▒Нр░ир░┐ р░╕р░Вр░Чр▒Нр░░р░╣р░┐р░╕р▒Нр░др▒Лр░Вр░жр░┐...",
        "extracting_pdf": "PDF р░ир▒Бр░Вр░бр░┐ р░╡р░Ър░ир░╛р░ир▒Нр░ир░┐ р░╕р░Вр░Чр▒Нр░░р░╣р░┐р░╕р▒Нр░др▒Лр░Вр░жр░┐...",
        "results_title": "р░╡р░┐р░╢р▒Нр░▓р▒Зр░╖р░г р░лр░▓р░┐р░др░╛р░▓р▒Б",
        "no_data": "р░Ор░Яр▒Бр░╡р░Вр░Яр░┐ р░ор▒Жр░бр░┐р░Хр░▓р▒Н р░бр▒Зр░Яр░╛ р░Хр░ир▒Бр░Чр▒Кр░ир░мр░бр░▓р▒Зр░жр▒Б.",
        "view_raw": "р░ор▒Бр░бр░┐ р░╡р░Ър░ир░╛р░ир▒Нр░ир░┐ р░Ър▒Вр░бр░Вр░бр░┐",
        "extraction_failed": "р░╕р░Вр░Чр▒Нр░░р░╣р░г р░╡р░┐р░лр░▓р░ор▒Ир░Вр░жр░┐",
        "delete_btn": "р░лр▒Ир░▓р▒НтАМр░ир░┐ р░др▒Кр░▓р░Чр░┐р░Вр░Ър░Вр░бр░┐",
        "delete_success": "р░лр▒Ир░▓р▒Н р░╡р░┐р░Ьр░пр░╡р░Вр░др░Вр░Чр░╛ р░др▒Кр░▓р░Чр░┐р░Вр░Ър░мр░бр░┐р░Вр░жр░┐.",
        "rec_title": "р░╡р▒Нр░пр░Хр▒Нр░др░┐р░Чр░д р░╕р░┐р░лр░╛р░░р▒Нр░╕р▒Бр░▓р▒Б",
        "rec_intro": "р░ор▒А р░лр░▓р░┐р░др░╛р░▓ р░Жр░зр░╛р░░р░Вр░Чр░╛, р░Зр░Хр▒Нр░Хр░б р░Хр▒Кр░ир▒Нр░ир░┐ р░Ьр▒Ар░╡р░ир░╢р▒Ир░▓р░┐ р░ор░░р░┐р░пр▒Б р░Жр░╣р░╛р░░ р░╕р▒Вр░Ър░ир░▓р▒Б р░Йр░ир▒Нр░ир░╛р░пр░┐.",
        "foods": "ЁЯеЧ р░др░┐р░ир░╡р░▓р░╕р░┐р░и р░Жр░╣р░╛р░░р░╛р░▓р▒Б",
        "lifestyle": "ЁЯПГ р░Ьр▒Ар░╡р░ир░╢р▒Ир░▓р░┐",
        "avoid": "ЁЯЪл р░ир░┐р░╡р░╛р░░р░┐р░Вр░Ър░╛р░▓р▒Нр░╕р░┐р░ир░╡р░┐",
        "disclaimer": "тЪая╕П р░ир░┐р░░р░╛р░Хр░░р░г: р░И р░╕р░┐р░лр░╛р░░р▒Нр░╕р▒Бр░▓р▒Б р░╕р░ор░╛р░Ър░╛р░░ р░кр▒Нр░░р░пр▒Лр░Ьр░ир░╛р░▓ р░Хр▒Лр░╕р░В р░ор░╛р░др▒Нр░░р░ор▒З р░ор░░р░┐р░пр▒Б р░╡р▒Ир░жр▒Нр░п р░╕р░▓р░╣р░╛ р░Хр░╛р░жр▒Б. р░жр░пр░Ър▒Зр░╕р░┐ р░ор▒А р░╡р▒Ир░жр▒Нр░пр▒Бр░бр░┐р░ир░┐ р░╕р░Вр░кр▒Нр░░р░жр░┐р░Вр░Ър░Вр░бр░┐.",
        "app_warning": "р░И р░пр░╛р░кр▒Н р░╕р░╛р░зр░╛р░░р░г р░Жр░░р▒Лр░Чр▒Нр░п р░╕р░ор░╛р░Ър░╛р░░р░╛р░ир▒Нр░ир░┐ р░Ер░Вр░жр░┐р░╕р▒Нр░др▒Бр░Вр░жр░┐. р░жр░пр░Ър▒Зр░╕р░┐ р░╡р▒Ир░жр▒Нр░пр▒Бр░бр░┐р░ир░┐ р░╕р░Вр░кр▒Нр░░р░жр░┐р░Вр░Ър░Вр░бр░┐.",
        "feedback_title": "р░Зр░жр░┐ р░╕р░╣р░╛р░пр░Хр░░р░Вр░Чр░╛ р░Йр░Вр░жр░╛?"
    },
    "ta": {
        "title": "ро╕рпНрооро╛ро░рпНроЯрпНроорпЖроЯрпН AI",
        "subheader": "рооро░рпБродрпНродрпБро╡ роЕро▒ро┐роХрпНроХрпИ роЖропрпНро╡ро╛ро│ро░рпН",
        "upload_label": "роЙроЩрпНроХро│рпН рооро░рпБродрпНродрпБро╡ роЕро▒ро┐роХрпНроХрпИропрпИрокрпН рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН (PDF / Image)",
        "success": "роХрпЛрокрпНрокрпБ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ рокродро┐ро╡рпЗро▒рпНро▒рокрпНрокроЯрпНроЯродрпБ.",
        "file_name": "роХрпЛрокрпНрокрпБ рокрпЖропро░рпН",
        "file_size": "роХрпЛрокрпНрокрпБ роЕро│ро╡рпБ",
        "extracting_img": "рокроЯродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБ роЙро░рпИропрпИрокрпН рокро┐ро░ро┐родрпНродрпЖроЯрпБроХрпНроХро┐ро▒родрпБ...",
        "extracting_pdf": "PDF роЗро▓ро┐ро░рпБроирпНродрпБ роЙро░рпИропрпИрокрпН рокро┐ро░ро┐родрпНродрпЖроЯрпБроХрпНроХро┐ро▒родрпБ...",
        "results_title": "рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роорпБроЯро┐ро╡рпБроХро│рпН",
        "no_data": "роХроЯрпНроЯроорпИроХрпНроХрокрпНрокроЯрпНроЯ рооро░рпБродрпНродрпБро╡родрпН родро░ро╡рпБ роОродрпБро╡рпБроорпН роХро╛рогрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.",
        "view_raw": "роорпВро▓ роЙро░рпИропрпИрокрпН рокро╛ро░рпНроХрпНроХро╡рпБроорпН",
        "extraction_failed": "рокро┐ро░ро┐родрпНродрпЖроЯрпБродрпНродро▓рпН родрпЛро▓рпНро╡ро┐ропроЯрпИроирпНродродрпБ",
        "delete_btn": "роХрпЛрокрпНрокрпИ роирпАроХрпНроХрпБ",
        "delete_success": "роХрпЛрокрпНрокрпБ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ.",
        "rec_title": "родройро┐рокрпНрокропройро╛роХрпНроХрокрпНрокроЯрпНроЯ рокро░ро┐роирпНродрпБро░рпИроХро│рпН",
        "rec_intro": "роЙроЩрпНроХро│рпН роорпБроЯро┐ро╡рпБроХро│ро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН, роЪро┐ро▓ ро╡ро╛ро┤рпНроХрпНроХрпИ роорпБро▒рпИ рооро▒рпНро▒рпБроорпН роЙрогро╡рпБ рокро░ро┐роирпНродрпБро░рпИроХро│рпН роЗроЩрпНроХрпЗ роЙро│рпНро│рой.",
        "foods": "ЁЯеЧ роЪро╛рокрпНрокро┐роЯ ро╡рпЗрогрпНроЯро┐роп роЙрогро╡рпБроХро│рпН",
        "lifestyle": "ЁЯПГ ро╡ро╛ро┤рпНроХрпНроХрпИ роорпБро▒рпИ",
        "avoid": "ЁЯЪл родро╡ро┐ро░рпНроХрпНроХро╡рпБроорпН",
        "disclaimer": "тЪая╕П рооро▒рпБрокрпНрокрпБ: роЗроирпНрод рокро░ро┐роирпНродрпБро░рпИроХро│рпН родроХро╡ро▓рпН роирпЛроХрпНроХроЩрпНроХро│рпБроХрпНроХро╛роХ роороЯрпНроЯрпБроорпЗ рооро▒рпНро▒рпБроорпН рооро░рпБродрпНродрпБро╡ роЖро▓рпЛроЪройрпИ роЕро▓рпНро▓. роЙроЩрпНроХро│рпН рооро░рпБродрпНродрпБро╡ро░рпИ роЕрогрпБроХро╡рпБроорпН.",
        "app_warning": "роЗроирпНрод рокропройрпНрокро╛роЯрпБ рокрпКродрпБро╡ро╛рой роЪрпБроХро╛родро╛ро░ родроХро╡ро▓рпНроХро│рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ. рооро░рпБродрпНродрпБро╡ро░рпИ роЕрогрпБроХро╡рпБроорпН.",
        "feedback_title": "роЗродрпБ рокропройрпБро│рпНро│родро╛роХ роЗро░рпБроирпНродродро╛?"
    }
}

def get_ui_label(key, lang_code="en"):
    """Fetch UI label with fallback to English."""
    label = UI_LABELS.get(lang_code, UI_LABELS["en"]).get(key, key)
    return label

@st.cache_data
def translate_text(text, target_lang):
    """
    Translates text dynamically using Deep Translator.
    Cached to avoid repeated API calls for same text.
    Returns original text if translation fails.
    """
    if target_lang == "en" or not text:
        return text
        
    try:
        translated = GoogleTranslator(source='auto', target=target_lang).translate(text)
        return translated if translated else text
    except Exception as e:
        logger.warning(f"DeepTranslator failed for '{text[:20]}...': {e}")
        return text 
